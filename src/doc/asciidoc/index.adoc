= Selenium-Jupiter
Boni Garc√≠a
Version {project-version}

:revnumber: {project-version}

== Motivation
https://seleniumhq.github.io/docs/site/en/webdriver/[Selenium WebDriver] is a library that allows controlling web browsers programmatically. It provides a cross-browser API that can be used to drive web browsers (e.g., Chrome, Edge, or Firefox, among others) using different programming languages (e.g., Java, JavaScript, Python, C#, or Ruby). The primary use of Selenium WebDriver is implementing automated tests for web applications. For this reason, it is a common practice to embed the calls to the Selenium WebDriver API in tests implemented using a unit testing framework like JUnit.

https://junit.org/junit5/[JUnit 5] is the next generation of the popular testing framework JUnit. It provides a brand-new programming and extension model called _Jupiter_. The comprehensive nature of Jupiter is very convenient to develop Selenium WebDriver tests on the top of JUnit 5.

.What is Selenium-Jupiter?
****
https://github.com/bonigarcia/selenium-jupiter[Selenium-Jupiter] is an open-source Java library that implements a JUnit 5 extension for developing Selenium WebDriver tests. Selenium-Jupiter uses several features of the Jupiter extension (such as parameters resolution, test templates, or conditional test execution). Thanks to this, the resulting Selenium-Jupiter tests follow a minimalist approach (i.e., the required boilerplate code for WebDriver is reduced) while providing a wide range of advanced features for end-to-end testing.
****

ifndef::backend-pdf[]
ifndef::backend-epub3[]
++++
include::carbon.html[]
++++
endif::[]
endif::[]

== Setup
Selenium-Jupiter should be used as a Java dependency (JDK 8+ required). We typically use a _build tool_ (such as https://maven.apache.org/[Maven] or https://gradle.org/[Gradle]) to resolve the Selenium-Jupiter dependency. In Maven, it can be done as follows (notice that it is declared using the `test` scope since it is typically used in tests classes):

[source,xml,subs="attributes+"]
----
<dependency>
    <groupId>io.github.bonigarcia</groupId>
    <artifactId>selenium-jupiter</artifactId>
    <version>{project-version}</version>
    <scope>test</scope>
</dependency>
----

In the case of a Gradle project, we can declare Selenium-Jupiter as follows (again, for tests):

[source,json,subs="attributes+"]
----
dependencies {
    testImplementation("io.github.bonigarcia:selenium-jupiter:{project-version}")
}
----

WARNING: As of version 4, Selenium-Jupiter does not include Selenium WebDriver as a transitive dependency.

== Features
Selenium-Jupiter provides an extension class for Jupiter tests called `SeleniumJupiter` (available in the package `io.github.bonigarcia.seljup`). This extension class should be used as a parameter in the annotation `@ExtendWith` (or `@RegisterExtension`) of a Jupiter test.

=== Local browsers
At first glance, Selenium-Jupiter seamlessly uses local browsers (e.g., Chrome, Firefox, Edge, etc.). To that aim, Selenium-Jupiter uses the _parameter resolution_ mechanism provided by Jupiter. This way, we simply need to declare a parameter of the `WebDriver` hierarchy (e.g., `ChromeDriver` to control Chrome, `FirefoxDriver` to control Firefox, etc.) as a test parameter. Internally, Selenium-Jupiter uses https://bonigarcia.dev/webdrivermanager/[WebDriverManager] to manage the required driver (e.g., chromedriver for Chrome) before starting the test. Then, it instantiates the `WebDriver` object and injects it into the test. Finally, it terminates the browser gracefully. All in all, the required boilerplate of a test using Selenium WebDriver and Selenium-Jupiter is reduced to the minimum. The following test shows a basic example of this feature:

[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/local/ChromeTest.java[tags=snippet-in-doc,indent=0]
----

The possible `WebDriver` types we can specify as test parameters are `FirefoxDriver` (see https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/local/FirefoxTest.java[example]), `EdgeDriver` (see https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/local/EdgeTest.java[example]), `SafariDriver` (see https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/local/SafariTest.java[example]), `@Opera ChromeDriver` (see https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/local/OperaTest.java[example]), `InternetExplorerDriver` (see https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/local/IExplorerTest.java[example]), `ChromiumDriver` (see https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/local/ChromiumTest.java[example]), and `SelenideDriver` (for controlling browsers through https://selenide.org/[Selenide], see https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/selenide/SelenideTest.java[example]).

NOTE: `OperaDriver` has deprecated as of Selenium WebDriver 4.1.3. The recommended way to control Opera browsers starting in that version is through `ChromeDriver`, configured to use an Opera browser. For this reason, Selenium-Jupiter incorporated the annotation `@Opera` as of version 4.2.0.

WARNING: Most of the features provided by Selenium-Jupiter can be used in conjunction with Selenium WebDriver versions 3 and 4. Nevertheless, some of them (e.g., the class `ChromiumDriver` to control Chromium browsers) are only available in Selenium WebDriver 4.

TIP: Although not mandatory, it is highly recommended to use a logger library to trace your application and tests. In the case of WebDriverManager, you will see the relevant steps of the driver management following its traces. See for example the following https://www.stubbornjava.com/posts/logging-in-java-with-slf4j-and-logback)[tutorial] to use http://www.slf4j.org/[SLF4J ] and http://logback.qos.ch/[Logback]. Also, you can see an example of a Selenium-Jupiter test using logging https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/local/FirefoxTest.java[here] (this example uses this https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/resources/logback-test.xml[configuration file]).

=== Conditional tests
Selenium-Jupiter provides the class-level annotation `@EnabledIfBrowserAvailable` to conditionally skip tests. Thanks to this annotation, a test is skipped when the browser specified as a parameter is not available in the system. This capability allows executing the same test suite in different machines (e.g., a local Mac OS with Safari and a Linux CI server) independently of the browser availability. The following example shows a test that is skipped if Safari is not in the system.

[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/local/SafariTest.java[tags=snippet-in-doc,indent=0]
----

In addition, Selenium-Jupiter provides the class-level annotation `@EnabledIfDriverUrlOnline` for conditionally disabling tests depending on the availability of the driver URL. If this URL is online, it will be used for remote tests, for instance, as follows:

[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/remote/RemoteChromeTest.java[tags=snippet-in-doc,indent=0]
----

The last annotation provided by Selenium-Jupiter for custom test disabling is `@EnabledIfDockerAvailable`, which disables test when a Docker engine is not installed in the machine running the test.


[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/docker/DockerChromeBetaTest.java[tags=snippet-in-doc,indent=0]
----

=== Remote browsers
Selenium-Jupiter also allows controlling remote browsers. These browsers are typically provided by a https://www.selenium.dev/documentation/en/grid/[Selenium Grid] infrastructure or a cloud provider (such as https://saucelabs.com/[Sauce Labs], https://www.lambdatest.com/[LambdaTest], etc.). To this aim, Selenium-Jupiter provides two annotations:

* `@DriverUrl`:  Annotation used to identify the URL of the Selenium Server.
* `@DriverCapabilities`:  Annotation used to configure the desired capabilities, such as the browser type, version, platform, etc.

Both annotations can be defined at parameter or field-level. The following example shows a test using these annotations at the parameter-level. This example uses Selenium Grid in standalone mode to start a Selenium Server listening to port 4444 and hosting a Firefox browser. Notice that the type of parameter injected in the test is the generic `WebDriver` interface (it could also be `RemoteWebDriver`).

[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/remote/RemoteFirefoxTest.java[tags=snippet-in-doc,indent=0]
----

You can find an example of an equivalent remote test but defining the remote URL and capabilities at field-level https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/remote/RemoteChromeTest.java[here]. A similar example, but using Sauce Labs is this https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/remote/SauceLabsTest.java[one].

==== Appium

As of version 4.1.0, Selenium-Jupiter supports remote browsers hosted by https://appium.io/[Appium] 2. To use this feature, you need to specify the type `AppiumDriver`, and also the Appium server URL and capabilities. The following test shows a basic example:


[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/remote/AppiumTest.java[tags=snippet-in-doc,indent=0]
----

=== Docker browsers
Selenium-Jupiter allows using browsers in Docker containers in an effortless manner. To that aim, we need to associate the `@DockerBrowser` annotation to parameters of the type `WebDriver` or `RemoteWebDriver` in Jupiter tests. Simply with that, Selenium-Jupiter discovers the latest version of the browser in Docker Hub, pulls this image (if necessary), and starts the browser in the Docker container. The following example shows how to use this feature with a Chrome browser in Docker:

[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/docker/DockerChromeTest.java[tags=snippet-in-doc,indent=0]
----

The used Docker images by Selenium-Jupiter have been created and maintained by https://aerokube.com/selenoid/[Aerokube] (you can check the available versions on the https://aerokube.com/images/latest/[browser images] page). Therefore, the available browsers to be executed as Docker containers in WebDriverManager are https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/docker/DockerChromeTest.java[Chrome], https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/docker/DockerFirefoxTest.java[Firefox], https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/docker/DockerEdgeTest.java[Edge], https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/docker/DockerOperaTest.java[Opera], https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/docker/DockerSafariTest.java[Safari], and https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/docker/DockerChromeMobileTest.java[Chrome Mobile].

NOTE: The case of Safari is particular since a real Safari browser can only be executed under a Mac OS machine. This way, the Safari Docker containers use the https://webkit.org/[WebKit engine]. This engine is the same used in browser containers, and therefore, from a functional point of view, both browsers (a real Safari and this Docker image) should behave in the same way.

WARNING: Notice you will need hardware virtualization (hypervisor) or a virtual machine with nested virtualization support to run Chrome Mobile images.

==== Browser Versions
A significant aspect of the Docker containers for browsers is that the latest version on Docker Hub is used when the browser version is not specified (like the examples explained before). This way, these _dockerized_ browsers are auto-maintained, in the sense that these tests use the latest version available without any additional effort.

Nevertheless, we can use a browser version in Docker using the attribute `version()` of the `@DockerBrowser` annotation. This attribute accepts a `String` parameter specifying the version. This version can be fixed (e.g., `91.0`), and it also accepts the following wildcards:

* `"latest"` : To specify the latest version explicitly (default option).
* `"latest-N"` : Where `N` is an integer value to be subtracted from the current stable version. For example, if we specify `latest-1` (i.e., _latest version minus one_), the previous version to the stable release will be used (see an example https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/docker/DockerChromeLatestMinusOneTest.java[here]).
* `"beta"`: To use the beta version. This version is only available for Chrome and Firefox, thanks to the Docker images maintained by https://hub.docker.com/r/twilio/selenoid/[Twilio] (a fork of the Aerokube images for the beta and development versions of Chrome and Firefox).
* `"dev"`: To use the development version (again, for Chrome and Firefox).

The following example shows a test using Chrome beta in Docker (see a similar example using Firefox dev https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/docker/DockerFirefoxDevTest.java[here]).

[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/docker/DockerChromeBetaTest.java[tags=snippet-in-doc,indent=0]
----

==== Remote Desktop
A possible inconvenience of using browsers in Docker is that we cannot see what is happening inside the container by default. Selenium-Jupiter allows connecting to the remote desktop session by simply setting to `true` the attribute `vnc` of the `@DockerBrowser` annotation to improve this situation. When using this option, two different technologies are used internally:

* Virtual Network Computing (https://en.wikipedia.org/wiki/Virtual_Network_Computing[VNC]), a graphical desktop sharing system. In WebDriverManager, a VNC server is started in the browser container.
* https://novnc.com/[noVNC], a open-source web-based VNC client. In Selenium-Jupiter, a custom https://github.com/bonigarcia/novnc[noVNC Docker image] is used to connect through noVNC.

The following example shows a test that enables this feature. We can see the noVNC URL in the `INFO` trace logs. We can use this URL to inspect and interact with the browser during the test execution (as shown in the following picture).

[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/docker/DockerChromeVncTest.java[tags=snippet-in-doc,indent=0]
----

TIP: Notice that the previous example also uses the attributes `lang` and `timezone` to change the https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes[language] and https://en.wikipedia.org/wiki/List_of_tz_database_time_zones[timezone] of the browser container.

[[vnc]]
[.thumb]
.Example of noVNC session using Chrome in Docker
image::seljup-vnc.png[scaledwidth=100%]

==== Recordings
The following related feature is the recording of the remote session of a dockerized browser. To enable it, we need to set to `true` the attribute `recording` of `@DockerBrowser`. Internally, Selenium-Jupiter starts another Docker container using https://ffmpeg.org/[FFmpeg] to record the browser session. At the end of the test, we can find the recording in MP4, by default, in the same folder of the project root. The following example shows a simple using this feature.

[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/docker/DockerChromeRecordingTest.java[tags=snippet-in-doc,indent=0]
----

WARNING: Notice that the previous example deletes the recording at the end of the test. If you want to keep the recording, omit the line `recordingFile.delete();`. The recording filename comprises the test name, parameter number, browser name, and session id (using the underscore symbol to separate these parts).

==== Browser List
Another important new feature of browsers in Docker is the possibility of asking for _many_ of them by the same test. This feature can be used to implement performance or load tests seamlessly. To use this feature, we need into account two aspects. First, you need to declare the attribute `size` of the annotation `@DockerBrowser`. This numeric value sets the number of browsers demanded by the test. Second, the test should declare a `List<RemoteWebDriver>` (or `List<WebDriver>`) parameter. For example, as follows:

[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/docker/DockerListTest.java[tags=snippet-in-doc,indent=0]
----

=== Browser Capabilities
Selenium-Jupiter provides different annotations to specify browser-specific capabilities (e.g., options, arguments, etc.) for the `WebDriver` objects to be created. These annotations are the following:

[[seljup_caps]]
.Selenium-Jupiter annotations for specifying capabilities
[options="header"]
|=======
|Anotation|Level|Description
|`@Options`|Field-level|To configure browsre options (e.g. `ChromeOptions` for Chrome and Opera, `FirefoxOptions` for Firefox, `EdgeOptions` for Edge, and `SafariOptions` for Safari)
|`@Arguments`|Parameter-level|To specify browser arguments (e.g., `--headless`, `--incognito`, etc.)
|`@Preferences`|Parameter-level|To specify Firefox arguments (e.g., `media.navigator.streams.fake=true`, etc.)
|`@Binary`|Parameter-level|To set the location of the browser binary
|`@Extensions`|Parameter-level|To add browser extensions (_plugins_)
|=======

NOTE: The annotations marked as _parameter-level_ are applied to a single _WebDriver_ parameter. The annotations marked as _field-level_ are applied globally in a test class.

The following example shows how to specify options for Chrome. In the first test (called `headlessTest`), we set the argument `--headless`, used for headless Chrome (i.e., without GUI). In the second test (`webrtcTest`), we use two different arguments: `--use-fake-device-for-media-stream` and `--use-fake-ui-for-media-stream`, used to fake user media (i.e., camera and microphone) in https://webrtc.org/[WebRTC] applications. In the third test (`extensionTest`), we add an extension to Chrome using the `@Extensions` annotation. The value of this field is an extension file that will be searched: i) using value as its relative/absolute path; ii) using value as a file name in the project classpath.

[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/capabilities/ChromeOptionsTest.java[tags=snippet-in-doc,indent=0]
----

You can find plenty of examples using the annotations presented in <<seljup_caps>> in the https://github.com/bonigarcia/selenium-jupiter/tree/master/src/test/java/io/github/bonigarcia/seljup/test/capabilities[Selenium-Jupiter tests].

TIP: You can use the capabilities annotations also for browsers in Docker (see https://github.com/bonigarcia/selenium-jupiter/tree/master/src/test/java/io/github/bonigarcia/seljup/test/docker/DockerChromeWebRtcTest.java[example]).

=== Template tests
Selenium-Jupiter uses a standard feature of JUnit 5 called http://junit.org/junit5/docs/current/user-guide/#writing-tests-test-templates[test templates]. Test templates are a special kind of test in which the same test logic is executed several times according to some custom data. In Selenium-Jupiter, the data to feed a test template is known as _browser scenario_.

The following example shows a test using this feature. 
Notice that instead of declaring the method with the usual `@Test` annotation, we use the JUnit 5's `@TestTemplate`. Then, the parameter type of the test template method is `WebDriver`. This type is the generic interface of Selenium WebDriver, and the concise type (i.e. `ChromeDriver,` `FirefoxDriver,` etc.) is determined by Selenium-Jupiter in runtime.

[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/template/TemplateTest.java[tags=snippet-in-doc,indent=0]
----

The next piece we need to execute this test template is the browser scenario. By default, a browser scenario is defined using a custom JSON notation (see below for details about this notation) called `browsers.json` and located in the project classpath (see <<advanced-configuration,advanced configuration>> section for other possibilities). For example:

[source,json]
----
include::../../test/resources/browsers.json[indent=0]
----

When we run the template test using this browser scenario, we will execute four tests using Chrome in Docker: the first using the stable (_latest_) version, the second using the previous to the stable version(`latest-1`), the third using the beta version (`beta`), and the last one using the development version (`dev`). If we run the test in Eclipse, for example, we will get the following output:

[.thumb]
.Example of test template execution in Eclipse
image::test-template.png[scaledwidth=100%]

The fields accepted in the JSON notation are the following:

* `type`: Type of browsers. It can be local (`chrome` , `firefox` , `edge` , `opera`, `safari` , `chromium` , or `iexplorer`) or in Docker (`chrome-in-docker`, `firefox-in-docker`, `edge-in-docker`, `opera-in-docker`, `safari-in-docker`, or `chrome-mobile`). In addition, as of Selenium-Jupiter 4.1.0, it is also possible to use the label `-in-selenide` to specify browsers controlled with Selenide. For example: https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/selenide/TemplateSelenideTest.java[test], https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/resources/browsers-selenide.json[scenario].
* `version`: Optional value for the version. Concrete versions (e.g., `63.0`, `58.0`, etc.) and wildcards (`latest`, `latest-N`, `beta`, and `dev`) are accepted.
* `arguments`: Arguments passed to the browser (e.g., `--headless`, `--incognito`,  etc.)
* `preferences`: Arguments for Firefox (e.g., `media.navigator.streams.fake=true`).
* `capabilities`: Custom key-value browser capabilities. See https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/resources/browsers-caps.json[example].
* `remoteUrl`: Selenium Server URL (for remote tests).

You can find different examples in the https://github.com/bonigarcia/selenium-jupiter/tree/master/src/test/java/io/github/bonigarcia/seljup/test/template[Selenium-Jupiter tests]. For instance: a test https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/template/TemplateRegisterTest.java[registering browser] in the scenario programmatically (instead of JSON), a test to use a https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/template/TemplateCapabilitiesTest.java[custom JSON browser scenario] (and capabilities), or another test using https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/template/TemplateTwoBrowsersTest.java[two browsers] in the same test.

=== Generic driver
Selenium-Jupiter allows using a configurable `WebDriver` object. This generic driver is declared as usual (i.e., test method or constructor parameter) using the type `RemoteWebDriver` or `WebDriver`. The concrete type of browser to be used is established utilizing the configuration key `wdm.defaultBrowser`. The default value for this key is `chrome`. All the values used in the template test defined in the previous section (i.e. `chrome`, `firefox`, `edge`, `chrome-in-docker`, `firefox-in-docker`, etc.) can also be used to define the type of browser in this mode. 

NOTE: See the <<advanced-configuration,advanced configuration>> section for further information about the configuration capabilities of Selenium-Jupiter.

For instance, the following test, if no additional configuration is done, will use Chrome:

[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/generic/GenericTest.java[tags=snippet-in-doc,indent=0]
----

=== Chrome DevTools
As of version 4.1.0, Selenium-Jupiter allows to inject `DevTools` instances in tests. This object used to send commands using the Chrome DevTools Protocol (CDP) to the driver declared just before in the test. For instance, the parameter `devTools` in following test allows to handle CDP commands of the browser handled with `driver`:

[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/devtools/FullPageScreenshotTest.java[tags=snippet-in-doc,indent=0]
----


=== Single session
By default, the instances provided by _Selenium-Jupiter_ (e.g. `ChromeDriver`, `FirefoxDriver`, etc.) are created _before each_ test, and are disposed _after each_ test. This default behavior can be changed using the class-level annotation `@SingleSession`. The instances provided in this case will be created _before all_ tests and are disposed _after all_ tests.

The following test shows an example of this feature. As you can see, this test uses the ordering capability provided as of JUnit 5.4. The browser (Chrome in this case) is available at the beginning for the tests. According to the given order, `testStep1()` is executed first. Then, the session (i.e., the same browser in the same state) is used by the second test, `testStep2()`. At the end of all tests, the browser is closed.

[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/singlessession/OrderedTest.java[tags=snippet-in-doc,indent=0]
----

=== Screenshots
Selenium-Jupiter allows making screenshots for each of the browser sessions at the end of the test. These screenshots can be encoded as Base64 or stored as PNG images. The following test shows an example. Notice that this feature can be enabled using the Java configuration (method `config()` of the Selenium-Jupiter instance. This instance can be obtained using the JUnit 5 annotation `@RegisterExtension` (see <<advanced-configuration,advanced configuration>> section for more information about configuration). The default image name is composed of the test name plus the `WebDriver` _sessionId_.

[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/screenshot/ScreenshotPngTest.java[tags=snippet-in-doc,indent=0]
----

WARNING: Notice that the previous example deletes the image at the end of the test. If you want to keep the picture, omit the line `imageFile.delete();`. The screenshot filename follows the same convention as the recordings.

=== Integration with Jenkins
Selenium-Jupiter seamlessly integrates with Jenkins through the https://plugins.jenkins.io/junit-attachments/[Jenkins attachment plugin]. This integration allows to attach output files of Selenium-Jupiter (typically PNG screenshots and MP4 recordings of Docker browsers) and keep these files associated with job execution in Jenkins. This is done using the method `useSurefireOutputFolder()` (or its equivalence configuration key `sel.jup.output.folder`) in Selenium-Jupiter (see <<advanced-configuration,advanced configuration>>). For instance:

[source,java]
----
include::../../test/java/io/github/bonigarcia/seljup/test/jenkins/JenkinsTest.java[tags=snippet-in-doc,indent=0]
----

If we run this test in Jenkins in which is already installed and configured the attachment plugin, at the end of the execution, a recording in MP4 and a PNG screenshot are attached to the Jenkins job, as shown in the following picture:

[.thumb]
.Example of test execution through Jenkins with attachments
image::jenkins-attachements-test.png[scaledwidth=100%]

== Examples
All the examples presented in this documentation are available in the https://github.com/bonigarcia/selenium-jupiter/tree/master/src/test/java/io/github/bonigarcia/seljup/test/[Selenium-Jupiter tests]. Moreover, different public repositories contain test examples using Selenium-Jupiter, such as:

* https://github.com/bonigarcia/selenium-jupiter-examples[Selenium-Jupiter Examples]: Different examples with JUnit 5, Selenium WebDriver, and Selenium-Jupiter.
* https://github.com/bonigarcia/selenium-jupiter-webrtc[Selenium-Jupiter WebRTC]: Tests aimed to assess https://webrtc.org/[WebRTC] video conference applications with Selenium-Jupiter.
* https://github.com/bonigarcia/rate-my-cat/[Rate my Cat!]: Complete sample application and tests using JUnit 5, Selenium WebDriver, Spring-Boot, and Mockito.
* https://github.com/bonigarcia/selenium-webdriver-java[Selenium WebDriver with Java]: A comprehensive collection of Selenium WebDriver 4 examples using Java as language binding.

== Advanced Configuration
Selenium-Jupiter provides different ways of configuration. First, by using its _Java configurator_. This capability is accessible by getting an instance of Selenium-Jupiter using the JUnit 5 annotation `@RegisterExtension` (see https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/screenshot/ScreenshotPngTest.java[example]).

The second alternative to tune Selenium-Jupiter is using _Java system properties_.  This way, each Java configurator method has its equivalence of a unique _configuration key_. For instance, the method `setOutputFolder()` (used to specify the output folder for screenshots and recordings) is equivalent to the configuration key `sel.jup.output.folder`. These types of configuration keys can be passed when executing the tests, for example, using Maven:

[source,shell]
----
mvn test -Dsel.jup.output.folder=/custom/path/to/output/folder
----

The third way to configure Selenium-Jupiter is using _environmental variables_. The names for these variables are made from converting each configuration key name (e.g., `sel.jup.output.folder`) to uppercase and replacing the symbol `.` with `_` (e.g., `SEL_JUP_OUTPUT_FOLDER`). These variables can be helpful to global setup parameters at the operating system level.

NOTE: The preference order of these configuration alternatives is (in case of overlapping) is: 1) Environmental Variables. 2) Java system properties. 3) Java configuration.

The following table describes all the possible Java methods in the Selenium-Jupiter configurator and its equivalent configuration keys.

[[server_config]]
.Configuration capabilities for Selenium-Jupiter
[options="header"]
|=======
|Java API|Configuration key|Default value|Description
|`setOutputFolder(String)` `useSurefireOutputFolder()`|`sel.jup.output.folder`|`.`|Output folder for recordings and screenshots. This key accepts the special value `surefire-reports` for the <<integration-with-jenkins,integration with Jenkins>>. In case of the special value `surefire-reports` there will *always* be a separate output folder per class (see below, `setOutputFolderPerClass(boolean)`).
|`setOutputFolderPerClass(boolean)`|`sel.jup.output.folder.per.class`|`false`|In case this value is `true`, the output files will be provided in separate folders per class. Otherwise, the output files
 will be directly provided in the output folder.
|`setScreenshot(boolean)` `enableScreenshot()`|`sel.jup.screenshot`|`false`|Enable screenshots at the end of the test
|`setScreenshotWhenFailure(boolean)` `enableScreenshotWhenFailure()`|`sel.jup.screenshot.when.failure`|`false`|Enable screenshots at the end of the test only if the test fails
|`setScreenshotFormat(String)` `takeScreenshotAsPng()` `takeScreenshotAsBase64()` `takeScreenshotAsBase64AndPng()`|`sel.jup.screenshot.format`|`png`|Configure screenshot format (accepted values: `png`, `base`, and `base64andpng`)
|`setRecording(boolean)` `enableRecording()`|`sel.jup.recording`|`false`|Enable recording of Docker browsers
|`setRecordingWhenFailure(true)` `enableRecordingWhenFailure()`|`sel.jup.recording.when.failure`|`false`|Enable recording of Docker browsers only if test fails
|`setVnc(boolean)` `enableVnc()`|`sel.jup.vnc`|`false`|Enable the remote access in Docker browsers
|`setBrowserTemplateJsonFile` `(String)`|`sel.jup.browser.template.` `json.file`|`classpath:browsers.json`|Location of the JSON browser scenario. If this value do not start with the word `classpath:`, the JSON file willbe searched using the specified path 
|`setBrowserTemplateJsonContent` `(String)`|`sel.jup.browser.template.` `json.content`|`""`|Content of JSON browsers scenario
|`setProperties(String)`|`sel.jup.properties`|`selenium-jupiter.` `properties`|Properties file (in the project classpath) for default configuration values
|`setSeleniumServerUrl(String)`|`sel.jup.selenium.server.url`|`""`|Remote URL used for remote (or template) tests
|=======

[discrete]
=== Tuning WebDriverManager
Selenium-Jupiter relies on https://bonigarcia.dev/webdrivermanager[WebDriverManager] for driver resolution (e.g., chromedriver, geckodriver, etc.) and `WebDriver` instantiation (including browsers in Docker). For this reason, the configuration key `wdm.defaultBrowser` is inherited from WebDriverManager to set up the default browser in the <<generic-driver,generic driver>>. If you need to customize WebDriverManager, the Selenium-Jupiter Java configurator provides the method `setManager(WebDriverManager)` to specify a custom WebDriverManager instance (see https://github.com/bonigarcia/selenium-jupiter/blob/master/src/test/java/io/github/bonigarcia/seljup/test/docker/DockerCustomWdmTest.java[example]).

== Known Issues
[discrete]
==== HTTP response code 403
Some of the drivers (e.g., geckodriver or operadriver) are hosted on GitHub. When external clients (like WebDriverManager) makes many consecutive requests to GitHub, and due to its traffic rate limit, it eventually responds with an HTTP 403 error (_forbidden_), as follows:

[source]
----
io.github.bonigarcia.wdm.config.WebDriverManagerException: Error HTTP 403 executing https://api.github.com/repos/mozilla/geckodriver/releases
    at io.github.bonigarcia.wdm.online.HttpClient.execute(HttpClient.java:172)
    at io.github.bonigarcia.wdm.WebDriverManager.openGitHubConnection(WebDriverManager.java:1266)
    at io.github.bonigarcia.wdm.WebDriverManager.getDriversFromGitHub(WebDriverManager.java:1280)
    at io.github.bonigarcia.wdm.managers.FirefoxDriverManager.getDriverUrls(FirefoxDriverManager.java:95)
    at io.github.bonigarcia.wdm.WebDriverManager.createUrlHandler(WebDriverManager.java:1111)
    at io.github.bonigarcia.wdm.WebDriverManager.download(WebDriverManager.java:959)
    at io.github.bonigarcia.wdm.WebDriverManager.manage(WebDriverManager.java:877)
    at io.github.bonigarcia.wdm.WebDriverManager.fallback(WebDriverManager.java:1106)
    at io.github.bonigarcia.wdm.WebDriverManager.handleException(WebDriverManager.java:1083)
    at io.github.bonigarcia.wdm.WebDriverManager.manage(WebDriverManager.java:883)
    at io.github.bonigarcia.wdm.WebDriverManager.setup(WebDriverManager.java:328)
----

To avoid this problem, WebDriverManager can make authenticated requests using a https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token[personal access token]. Take a look at the https://bonigarcia.dev/webdrivermanager/#advanced-configuration[WebDriverManager documentation] to discover how to set up this token.

[discrete]
==== Testing localhost
A typical case in web development is testing a web application deployed in the local host. In this case, and when using browsers in Docker containers, we need to know that the address `localhost` inside a Docker container is not the host's address but the container address. To solve this problem, we can take different approaches. In Linux, we can use the gateway address for inter-container communication. This address is usually `172.17.0.1`, and can be discovered as follows:

[source,shell]
----
$ ip addr show docker0
4: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default
    link/ether 02:42:b4:83:10:c8 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 scope global docker0
       valid_lft forever preferred_lft forever
----

When the host is Mac OS or Windows, we can use the DNS name `host.docker.internal`, which will be resolved to the internal IP address used by the host.

[discrete]
==== Chrome 92+ in Docker
There is an https://bugs.chromium.org/p/chromedriver/issues/detail?id=3857[open issue] with Chrome 92+ and Docker at the time of this writing. The problem can be solved by using the argument `--disable-gpu` in Chrome and Edge. This argument is used by Selenium-Jupiter 5 to avoid the issue. Nevertheless, some situations are still impossible to fix (e.g., when using https://hub.docker.com/r/bonigarcia/selenium-jupiter[Selenium-Jupiter in Docker] as CLI or Server).

== Community
There are two ways to try to get community support related to Selenium-Jupiter. First, questions about it can be discussed in https://stackoverflow.com/questions/tagged/selenium-jupiter[StackOverflow], using the tag _selenium-jupiter_. In addition, comments, suggestions, and bug-reporting should be made using the https://github.com/bonigarcia/selenium-jupiter/issues[GitHub issues]. Finally, if you think Selenium-Jupiter can be enhanced, consider contributing to the project through a  https://github.com/bonigarcia/selenium-jupiter/pulls[pull request].

== Support
https://opencollective.com/selenium-jupiter[Selenium-Jupiter] is part of https://opencollective.com/bonigarcia[OpenCollective], an online funding platform for open and transparent communities. You can support the project by contributing as a backer (i.e., a personal https://opencollective.com/selenium-jupiter/donate[donation] or https://opencollective.com/selenium-jupiter/contribute/backer-10377/checkout[recurring contribution]) or as a https://opencollective.com/selenium-jupiter/contribute/sponsor-10378/checkout[sponsor] (i.e., a recurring contribution by a company).

ifndef::backend-pdf[]
ifndef::backend-epub3[]
[discrete]
=== Backers
++++
include::backers.html[]
++++

[discrete]
=== Sponsors
++++
include::sponsors.html[]
++++
endif::[]
endif::[]

== Further Documentation
There are other resources related to Selenium-Jupiter and automated testing you can find helpful. For instance, the following books:

* Garc√≠a, Boni. https://www.oreilly.com/library/view/hands-on-selenium-webdriver/9781098109998/[Hands-On Selenium WebDriver with Java]. _O'Reilly Media, Inc._, Currently on early relase. Final release available on 2022.
* Garc√≠a, Boni. https://www.amazon.com/Mastering-Software-Testing-JUnit-Comprehensive-ebook/dp/B076ZQCK5Q/[Mastering Software Testing with JUnit 5]. _Packt Publishing Ltd_, 2017.

Or the following journal papers:

* Garc√≠a, Boni, et al. "https://link.springer.com/article/10.1007%2Fs10664-021-09975-3[Automated driver management for Selenium WebDriver]." _Empirical Software Engineering_ 26.5 (2021): 1-51.
* Garc√≠a, Boni, et al. "https://www.mdpi.com/2079-9292/9/7/1067[A survey of the Selenium ecosystem]." _Electronics_ 9.7 (2020): 1067.
* Garc√≠a, Boni, et al. "https://www.mdpi.com/2079-9292/9/3/462[Assessment of QoE for video and audio in WebRTC applications using full-reference models]." _Electronics_ 9.3 (2020): 462.
* Garc√≠a, Boni, et al. "https://www.mdpi.com/2079-9292/8/8/854[Practical evaluation of VMAF perceptual video quality for WebRTC applications]." _Electronics_ 8.8 (2019): 854.
* Garc√≠a, Boni, et al. "https://ieeexplore.ieee.org/document/7992926/[WebRTC testing: challenges and practical solutions]." _IEEE Communications Standards Magazine_ 1.2 (2017): 36-42.
* Garc√≠a, Boni, and Juan Carlos Due√±as. "https://www.rintonpress.com/journals/jweonline.html#v14n56[Web browsing automation for applications quality control]." _Journal of web engineering_ (2015): 474-502.

== About
Selenium-Jupiter (Copyright ¬© 2017-2021) is an open-source project created and maintained by https://bonigarcia.dev/[Boni Garc√≠a] (https://twitter.com/boni_gg[@boni_gg]), licensed under the terms of https://www.apache.org/licenses/LICENSE-2.0[Apache 2.0 License]. This documentation (also available in link:selenium-jupiter.pdf[PDF] and link:selenium-jupiter.epub[EPUB]) is released under the terms of https://creativecommons.org/licenses/by-nc-sa/2.0/[CC BY-NC-SA 2.0].
